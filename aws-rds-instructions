create table CUSTOMERS (
    id NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY (START WITH 42) NOT NULL PRIMARY KEY,
    first_name VARCHAR(50),
    last_name VARCHAR(50),
    email VARCHAR(50),
    gender VARCHAR(50),
    comments VARCHAR(90),
    create_ts timestamp DEFAULT CURRENT_TIMESTAMP ,
    update_ts timestamp
);

create table ACCOUNTS (
    id NUMBER(10) GENERATED BY DEFAULT ON NULL AS IDENTITY (START WITH 200) NOT NULL PRIMARY KEY,
    branch_id NUMBER(10),
    branch_name VARCHAR(50),
    account_num VARCHAR(50),
    account_type VARCHAR(15),
    currency VARCHAR(50),
    balance NUMBER(12,2),
    customer_id NUMBER(10) REFERENCES CUSTOMERS(ID),
    create_ts timestamp DEFAULT CURRENT_TIMESTAMP ,
    update_ts timestamp
);

insert into CUSTOMERS (id, first_name, last_name, email, gender, comments) values (1, 'Rica', 'Blaisdell', 'rblaisdell0@rambler.ru', 'Female',  'individual');
insert into CUSTOMERS (id, first_name, last_name, email, gender, comments) values (2, 'Ruthie', 'Brockherst', 'rbrockherst1@ow.ly', 'Female',  'individual');
insert into CUSTOMERS (id, first_name, last_name, email, gender, comments) values (3, 'Mariejeanne', 'Cocci', 'mcocci2@techcrunch.com', 'Female',  'corporate employee');
insert into CUSTOMERS (id, first_name, last_name, email, gender, comments) values (4, 'Hashim', 'Rumke', 'hrumke3@sohu.com', 'Male',  'corporate employee');
insert into CUSTOMERS (id, first_name, last_name, email, gender, comments) values (5, 'Hansiain', 'Coda', 'hcoda4@senate.gov', 'Male', 'individual');
insert into CUSTOMERS (id, first_name, last_name, email, gender, comments) values (6, 'Babu', 'T', 'babu@ssyq.gov', 'Male', 'individual');
insert into CUSTOMERS (id, first_name, last_name, email, gender, comments) values (7, 'Nate', 'Jones', 'natej@ssyq.gov', 'Male', 'corporate employee');

insert into ACCOUNTS (id, branch_id, branch_name, account_num, account_type, currency, balance, customer_id) values (1, 1234, 'Cumming', '320224231' , 'CHECK IN', 'USD', 1234.54, 1 );
insert into ACCOUNTS (id, branch_id, branch_name, account_num, account_type, currency, balance, customer_id) values (2, 1234, 'Cumming', '320224232' , 'SAVINGS', 'USD', 10000.00, 1 );
insert into ACCOUNTS (id, branch_id, branch_name, account_num, account_type, currency, balance, customer_id) values (3, 5234, 'Las Vegas', '320224233' , 'CHECK IN', 'USD', 111.54, 2 );
insert into ACCOUNTS (id, branch_id, branch_name, account_num, account_type, currency, balance, customer_id) values (4, 5234, 'Las Vegas', '320224234' , 'SAVINGS', 'USD', 2000.00, 2 );
insert into ACCOUNTS (id, branch_id, branch_name, account_num, account_type, currency, balance, customer_id) values (5, 5214, 'Alpharetta', '320224235' , 'CHECK IN', 'USD', 11.54, 3 );
insert into ACCOUNTS (id, branch_id, branch_name, account_num, account_type, currency, balance, customer_id) values (6, 5214, 'Alpharetta', '320224236' , 'SAVINGS', 'USD', 200.00, 3 );
insert into ACCOUNTS (id, branch_id, branch_name, account_num, account_type, currency, balance, customer_id) values (7, 414, 'Roswell', '320224237' , 'CHECK IN', 'USD', 101.54, 4 );
insert into ACCOUNTS (id, branch_id, branch_name, account_num, account_type, currency, balance, customer_id) values (8, 414, 'Roswell', '320224238' , 'SAVINGS', 'USD', 1010.00, 4 );
insert into ACCOUNTS (id, branch_id, branch_name, account_num, account_type, currency, balance, customer_id) values (9, 424, 'Nashville', '320224239' , 'CHECK IN', 'USD', 121.54, 5 );
insert into ACCOUNTS (id, branch_id, branch_name, account_num, account_type, currency, balance, customer_id) values (10, 424, 'Nashville', '320224240' , 'SAVINGS', 'USD', 1210.00, 5 );


#Confluent Oracle DB CDC permissions - Login to AWS RDS and execute below sql commands

CREATE USER DB_USER IDENTIFIED BY PASSWORD DEFAULT TABLESPACE USERS;
ALTER USER DB_USER IDENTIFIED BY testuser1;
ALTER USER DB_USER QUOTA UNLIMITED ON USERS;

GRANT CREATE SESSION TO DB_USER;
GRANT SELECT ON DBA_TABLESPACES TO DB_USER;
GRANT LOGMINING TO DB_USER;
GRANT SELECT ON ACCOUNTS TO DB_USER;
GRANT SELECT ON CUSTOMERS TO DB_USER;

exec rdsadmin.rdsadmin_util.grant_sys_object('ALL_VIEWS', 'DB_USER', 'SELECT');
exec rdsadmin.rdsadmin_util.grant_sys_object('ALL_TAB_PARTITIONS', 'DB_USER', 'SELECT');
exec rdsadmin.rdsadmin_util.grant_sys_object('ALL_INDEXES', 'DB_USER', 'SELECT');
exec rdsadmin.rdsadmin_util.grant_sys_object('ALL_OBJECTS', 'DB_USER', 'SELECT');
exec rdsadmin.rdsadmin_util.grant_sys_object('ALL_TABLES', 'DB_USER', 'SELECT');
exec rdsadmin.rdsadmin_util.grant_sys_object('ALL_USERS', 'DB_USER', 'SELECT');
exec rdsadmin.rdsadmin_util.grant_sys_object('ALL_CATALOG', 'DB_USER', 'SELECT');
exec rdsadmin.rdsadmin_util.grant_sys_object('ALL_CONSTRAINTS', 'DB_USER', 'SELECT');
exec rdsadmin.rdsadmin_util.grant_sys_object('ALL_CONS_COLUMNS', 'DB_USER', 'SELECT');
exec rdsadmin.rdsadmin_util.grant_sys_object('ALL_TAB_COLS', 'DB_USER', 'SELECT');
exec rdsadmin.rdsadmin_util.grant_sys_object('ALL_IND_COLUMNS', 'DB_USER', 'SELECT');
exec rdsadmin.rdsadmin_util.grant_sys_object('ALL_LOG_GROUPS', 'DB_USER', 'SELECT');
exec rdsadmin.rdsadmin_util.grant_sys_object('V_$ARCHIVED_LOG', 'DB_USER', 'SELECT');
exec rdsadmin.rdsadmin_util.grant_sys_object('V_$LOG', 'DB_USER', 'SELECT');
exec rdsadmin.rdsadmin_util.grant_sys_object('V_$LOGFILE', 'DB_USER', 'SELECT');
exec rdsadmin.rdsadmin_util.grant_sys_object('V_$DATABASE', 'DB_USER', 'SELECT');
exec rdsadmin.rdsadmin_util.grant_sys_object('V_$THREAD', 'DB_USER', 'SELECT');
exec rdsadmin.rdsadmin_util.grant_sys_object('V_$PARAMETER', 'DB_USER', 'SELECT');
exec rdsadmin.rdsadmin_util.grant_sys_object('V_$NLS_PARAMETERS', 'DB_USER', 'SELECT');
exec rdsadmin.rdsadmin_util.grant_sys_object('V_$TIMEZONE_NAMES', 'DB_USER', 'SELECT');
exec rdsadmin.rdsadmin_util.grant_sys_object('V_$TRANSACTION', 'DB_USER', 'SELECT');
exec rdsadmin.rdsadmin_util.grant_sys_object('DBA_REGISTRY', 'DB_USER', 'SELECT');
exec rdsadmin.rdsadmin_util.grant_sys_object('OBJ$', 'DB_USER', 'SELECT');
exec rdsadmin.rdsadmin_util.grant_sys_object('ALL_ENCRYPTED_COLUMNS', 'DB_USER', 'SELECT');
exec rdsadmin.rdsadmin_util.grant_sys_object('V_$LOGMNR_LOGS', 'DB_USER', 'SELECT');
exec rdsadmin.rdsadmin_util.grant_sys_object('V_$LOGMNR_CONTENTS','DB_USER','SELECT');
exec rdsadmin.rdsadmin_util.grant_sys_object('DBMS_LOGMNR', 'DB_USER', 'EXECUTE');

exec rdsadmin.rdsadmin_util.grant_sys_object('DBA_TABLESPACES', 'DB_USER', 'SELECT');
exec rdsadmin.rdsadmin_util.grant_sys_object('V_$INSTANCE', 'DB_USER', 'SELECT');
exec rdsadmin.rdsadmin_util.alter_supplemental_logging(p_action => 'ADD');


#Enable Supplemental Logging
exec rdsadmin.rdsadmin_util.set_configuration('archivelog retention hours',24);
exec rdsadmin.rdsadmin_util.alter_supplemental_logging('ADD','ALL');

#Flashback
GRANT FLASHBACK ANY TABLE TO DB_USER;
